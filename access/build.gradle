plugins {
  id "java"
  id "org.springframework.boot" version "3.0.1"
}

group "de.lukasbreuer.cast"
version "1.0.0-SNAPSHOT"

sourceCompatibility = 17
targetCompatibility = 17

repositories {
  mavenCentral()
}

configurations {
  archiveImplementation
  library

  all {
    exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    exclude group: 'ch.qos.logback', module: 'logback-classic'
    exclude group: 'org.apache.logging.log4j', module: 'log4j-to-slf4j'
  }
}

sourceSets {
  main {
    compileClasspath += configurations.archiveImplementation
  }
}

dependencies {
  implementation("de.lukasbreuer.cast:deploy:1.0.0-SNAPSHOT")
  archiveImplementation("de.lukasbreuer.cast:deploy:1.0.0-SNAPSHOT")
  library "org.deeplearning4j:deeplearning4j-core:1.0.0-M2.1"
  library "org.nd4j:nd4j-native-platform:1.0.0-M2.1"

  annotationProcessor "org.projectlombok:lombok:1.18.24"
  testAnnotationProcessor "org.projectlombok:lombok:1.18.24"

  implementation 'org.springframework.boot:spring-boot-starter-web:3.0.1'

  implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
  implementation 'io.jsonwebtoken:jjwt-impl:0.11.5'
  implementation 'io.jsonwebtoken:jjwt-gson:0.11.5'
}

test {
  useJUnitPlatform()
}

bootJar {
  manifest {
    attributes(
      "Class-Path": "libraries/org.deeplearning4j-1.0.0-M2.1.jar"
    )
  }
  exclude {
    configurations.library.resolvedConfiguration.files.contains(it.file)
  }
}